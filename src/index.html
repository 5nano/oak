<!DOCTYPE HTML>
<html>
<head>
<script>
window.onload = function () {

 var dataPoints = [];
 var experimentsData = [];
 var experimentData = [];

 var chart = new CanvasJS.Chart("chartContainer", {
 	theme:"light2",
 	animationEnabled: true,
 	title:{
 		text: "Área foliar en Trigo"
 	},
 	axisY :{
 		includeZero: false,
 		title: "Área foliar",
 		suffix: "mm2"
 	},
 	toolTip: {
 		shared: "true"
 	},
 	legend:{
 		cursor:"pointer",
 		itemclick : toggleDataSeries
 	},
 	data: dataPoints
 });


 $.ajax({
       url: "http://localhost:8080/bush/graficoComparativo/datosExperimentosCultivo?crop=tomate"
   }).then(function(data) {
      generateExperimentsData(data);
   });

 function generateExperimentsData(data) {

   for (var i = 0; i < data.length; i++) {
     experimentData=[];
     for (var j = 0; j < data[i].dataPoints.length; j++) {
       experimentData.push({
         label: data[i].dataPoints[j].label,
         y: data[i].dataPoints[j].y
       });
     }
     experimentsData.push(experimentData);

   }
   addDataPoints(data);
}

function addDataPoints(data) {
  for (var h = 0; h < data.length; h++) {
    dataPoints.push({
      type: "spline",
      showInLegend: true,
      visible: false,
      ValueFormatString: "##.00mn",
      name: "Experimento ".concat((h+1)),
      dataPoints: experimentsData[h]
    });
  }
  chart.render();
}

function toggleDataSeries(e) {
	if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible ){
		e.dataSeries.visible = false;
	} else {
		e.dataSeries.visible = true;
	}
	chart.render();
}


$.ajax({
    type: "get", url: "http://localhost:8080/bush/prueba/imagenBase64?testId=1&experimentId=1",
    success: function (data, text) {
      generateTestImage(data);

    },
    error: function (request, status, error) {
        alert(error);
    }
});


function generateTestImage(base64Image){

  var src = "data:image/jpeg;base64,";
src += base64Image;
var newImage = document.createElement('img');
newImage.src = src;
newImage.width = newImage.height = "300";
document.querySelector('#someDiv').innerHTML = newImage.outerHTML;//where to insert your image

}

}
</script>
</head>
<body>
<div id="chartContainer" style="height: 370px; width: 100%;"></div>
<div id = 'someDiv'>
</div>
<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>
</html>
